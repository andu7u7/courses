VENV = .venv
PYTHON = python3
PIP = $(PYTHON) -m pip
MAIN_FILE = main.py

.PHONY: install update run clean help

# Objetivo por defecto
help:
	@echo "Usage:"
	@echo "  make install    - Crear entorno virtual e instalar dependencias"
	@echo "  make update     - Actualizar requirements.txt con las dependencias actuales"
	@echo "  make run        - Ejecutar la aplicaciÃ³n"
	@echo "  make clean      - Eliminar archivos generados y entorno virtual"

# Instalar dependencias
install:
	@echo "ğŸ“¦ Instalando dependencias..."
	@test -d $(VENV) || $(PYTHON) -m venv $(VENV)
	@. $(VENV)/bin/activate && $(PIP) install --upgrade pip
	@. $(VENV)/bin/activate && $(PIP) install -r requirements.txt
	@echo "âœ… InstalaciÃ³n completada"

# Actualizar requirements.txt
update:
	@echo "ğŸ”„ Actualizando requirements.txt..."
	@test -d $(VENV) || (echo "âŒ Ejecute 'make install' primero" && exit 1)
	@echo -n "âš ï¸  Esta acciÃ³n sobrescribirÃ¡ su requirements.txt actual. Â¿Continuar? [y/N] " && read CONFIRM && [ "$${CONFIRM}" = "y" -o "$${CONFIRM}" = "Y" ] || (echo "âŒ OperaciÃ³n cancelada" && exit 1)
	@. $(VENV)/bin/activate && $(PIP) freeze > requirements.txt
	@echo "âœ… requirements.txt actualizado"

# Ejecutar aplicaciÃ³n
run:
	@test -d $(VENV) || (echo "âŒ Ejecute 'make install' primero" && exit 1)
	@echo "ğŸš€ Ejecutando $(MAIN_FILE)..."
	@. $(VENV)/bin/activate && $(PYTHON) -B $(MAIN_FILE)

# Limpiar proyecto
clean:
	@echo "ğŸ§¹ Limpiando proyecto..."
	@rm -rf __pycache__ .pytest_cache .coverage htmlcov
	@rm -rf $(VENV)
	@echo "âœ… Limpieza completada"
